# 戦闘動作確認チェックリスト

## 概要

敵とプレイヤーキャラクターの戦闘が正常に動作するかを確認するためのチェックリストです。

## 確認項目

### 1. 基本設定の確認

#### 1.1 タグの設定
- [ ] プレイヤーキャラクターのタグが`Player`に設定されているか
- [ ] 敵のタグが`Enemy`に設定されているか
- [ ] プレイヤー城のタグが`PlayerCastle`に設定されているか

#### 1.2 Collider2Dの設定
- [ ] プレイヤーキャラクターに`Collider2D`がアタッチされているか
- [ ] 敵に`Collider2D`がアタッチされているか
- [ ] プレイヤー城に`Collider2D`がアタッチされているか
- [ ] Colliderのサイズが適切か（攻撃範囲内に入るように）

### 2. プレイヤーキャラクターの戦闘動作確認

#### 2.1 Warrior（近接戦闘型）
- [ ] 敵が攻撃範囲内に入ると移動を停止するか
- [ ] 攻撃クールダウンが経過すると攻撃するか
- [ ] 攻撃時に敵にダメージを与えるか
- [ ] 敵が死亡すると移動を再開するか
- [ ] 複数の敵がいる場合、最も近い敵を攻撃するか

#### 2.2 Archer（遠距離攻撃型）
- [ ] 敵が攻撃範囲内に入ると移動を停止するか
- [ ] 投射物プレハブが設定されている場合、投射物を発射するか
- [ ] 投射物プレハブが設定されていない場合、直接ダメージを与えるか（暫定実装）
- [ ] 攻撃時に敵にダメージを与えるか

#### 2.3 Mage（魔法攻撃型）
- [ ] 敵が攻撃範囲内に入ると移動を停止するか
- [ ] 投射物プレハブが設定されている場合、投射物を発射するか
- [ ] 投射物プレハブが設定されていない場合、直接ダメージを与えるか（暫定実装）
- [ ] 攻撃時に敵にダメージを与えるか

### 3. 敵の戦闘動作確認

#### 3.1 Enemy_Orc（基本敵）
- [ ] プレイヤーキャラクターが攻撃範囲内に入ると移動を停止するか
- [ ] 攻撃クールダウンが経過すると攻撃するか
- [ ] 攻撃時にプレイヤーキャラクターにダメージを与えるか
- [ ] プレイヤー城が攻撃範囲内に入ると攻撃するか
- [ ] ターゲットが死亡すると移動を再開するか

#### 3.2 Enemy_Goblin（弱い敵）
- [ ] プレイヤーキャラクターが攻撃範囲内に入ると移動を停止するか
- [ ] 攻撃クールダウンが経過すると攻撃するか
- [ ] 攻撃時にプレイヤーキャラクターにダメージを与えるか
- [ ] プレイヤー城が攻撃範囲内に入ると攻撃するか

### 4. ダメージシステムの確認

#### 4.1 ダメージ計算
- [ ] 攻撃力が正しく適用されるか
- [ ] 防御力が正しく考慮されるか（最小ダメージは1）
- [ ] HPが減少するか
- [ ] HPが0になると死亡するか

#### 4.2 HP管理
- [ ] `HealthSystem`が正しく動作するか
- [ ] HPが変更されるとイベントが発火するか
- [ ] 死亡時に`OnDeath`イベントが発火するか

### 5. 衝突検出の確認

#### 5.1 攻撃範囲の検出
- [ ] `Physics2D.OverlapCircleAll`が正しく動作するか
- [ ] 攻撃範囲内の敵/ターゲットが正しく検出されるか
- [ ] 攻撃範囲外の敵/ターゲットは検出されないか

#### 5.2 タグによる検出
- [ ] `Player`タグを持つオブジェクトが正しく検出されるか
- [ ] `Enemy`タグを持つオブジェクトが正しく検出されるか
- [ ] `PlayerCastle`タグを持つオブジェクトが正しく検出されるか

### 6. 動作確認手順

#### ステップ1: 基本動作確認
1. シーンを再生
2. プレイヤーキャラクター（Warrior）を召喚
3. 敵（Enemy_Orc）をスポーン
4. 両者が接近するまで待つ
5. 以下の動作を確認：
   - 両者が停止する
   - 攻撃が開始される
   - ダメージが与えられる
   - HPが減少する
   - どちらかが死亡する

#### ステップ2: 複数ユニットの確認
1. 複数のプレイヤーキャラクターを召喚
2. 複数の敵をスポーン
3. 戦闘が正常に動作するか確認

#### ステップ3: 城への攻撃確認
1. 敵をスポーン
2. 敵がプレイヤー城に到達するまで待つ
3. 敵が城を攻撃するか確認
4. 城のHPが減少するか確認

## トラブルシューティング

### 問題1: キャラクターが攻撃しない

**原因**:
- Collider2Dが設定されていない
- タグが正しく設定されていない
- 攻撃範囲が小さすぎる

**解決方法**:
1. Collider2Dを確認・追加
2. タグを確認・設定
3. `CharacterData`/`EnemyData`の`Attack Range`を確認

### 問題2: ダメージが与えられない

**原因**:
- `IDamageable`インターフェースが実装されていない
- `HealthSystem`がアタッチされていない
- ダメージ計算が正しく動作していない

**解決方法**:
1. `CharacterBase`/`EnemyBase`が`IDamageable`を実装しているか確認
2. `HealthSystem`が自動追加されているか確認
3. Consoleでダメージログを確認

### 問題3: 移動が停止しない

**原因**:
- `CharacterMovementController`/`EnemyController`が正しく動作していない
- `StopMovement`メソッドが呼ばれていない

**解決方法**:
1. `CharacterMovementController`/`EnemyController`がアタッチされているか確認
2. 攻撃範囲内に敵/ターゲットがいるか確認
3. Debug.Logで`StopMovement`が呼ばれているか確認

### 問題4: 攻撃範囲が正しく検出されない

**原因**:
- `Physics2D.OverlapCircleAll`の設定が間違っている
- Collider2Dのサイズが適切でない
- レイヤー設定が間違っている

**解決方法**:
1. `Attack Range`の値を確認
2. Collider2Dのサイズを確認
3. Physics2Dの設定を確認

## デバッグ方法

### Debug.Logの追加

戦闘システムの各メソッドにDebug.Logを追加して動作を確認：

```csharp
// Warrior.cs
private void Attack(IDamageable target)
{
    Debug.Log($"[Warrior] Attack called. Target: {target}, Damage: {characterBase.AttackPower}");
    // ...
}

// Enemy_Orc.cs
private void Attack(IDamageable target)
{
    Debug.Log($"[Enemy_Orc] Attack called. Target: {target}, Damage: {enemyBase.AttackPower}");
    // ...
}
```

### 攻撃範囲の可視化

Sceneビューで攻撃範囲を可視化する：

```csharp
private void OnDrawGizmosSelected()
{
    Gizmos.color = Color.red;
    Gizmos.DrawWireSphere(transform.position, attackRange);
}
```

## 次のステップ

戦闘動作確認が完了したら：
1. バランス調整（HP、攻撃力、防御力、攻撃速度）
2. 投射物システムの実装（Archer、Mage用）
3. エフェクトの追加（攻撃エフェクト、ダメージエフェクト）
