# マスタープロジェクト仕様書

## ゲーム概要

本プロジェクトは、にゃんこ大戦争を参考にしたタワーディフェンスゲームに、英単語学習機能を組み合わせた教育ゲームです。

### コンセプト

- **ジャンル**: タワーディフェンス × 英単語学習（リアルタイムストラテジー要素あり）
- **プレイスタイル**: 英単語問題に答えてPowerを獲得し、そのPowerでキャラクターを召喚して自動戦闘
- **目標**: 敵の城のHPを0にしてステージをクリアする
- **学習要素**: 英単語問題に正解することでリソース（Power）を獲得し、ゲームを有利に進める

### ゲームフロー

1. ゲーム開始時に、ゲームモードを選択する（「English to Japanese」「Japanese to English」）
   - ゲームモード選択前は、キャラクター選択パネルは非表示で、ボタンを押すことができない
   - ゲームモード選択前は、Powerの自動増加も行われない
2. ゲームモード選択後、キャラクター選択パネルが表示され、ゲームが開始される
3. ステージ開始時、プレイヤーの城（左側）と敵の城（右側）が配置される
4. 画面中央に英単語問題が表示され、選択肢から正解を選ぶ
5. 問題には制限時間（デフォルト10秒）があり、タイマーが表示される
6. 正解するとPowerが増加する（デフォルト+30、インスペクターで変更可能）
7. 不正解または時間切れの場合はPowerは増えない
8. 獲得したPowerを使ってキャラクターアイコンをタップし、キャラクターを召喚
9. 召喚されたキャラクターは自動的に右方向へ進軍し、敵キャラクターと遭遇すると戦闘を開始
10. 敵キャラクターを倒しながら進軍を続け、最終的に敵の城に到達して攻撃
11. 攻撃時、キャラクターやエネミーは移動方向（またはターゲット方向）に少し前進する突進アニメーションが発生
12. 敵の城のHPが0になると「Win!」が緑で表示され、ゲーム終了（タイマー・スポーン・キャラクター・エネミーの動きが停止）
13. プレイヤーの城のHPが0になると「Lost!」が赤で表示され、ゲーム終了（タイマー・スポーン・キャラクター・エネミーの動きが停止）
14. ゲーム終了後、キャラクター強化UIが表示される（3つのボタンから1つだけ選択可能：Warrior、Archer、MageのHP強化など）
15. 強化ボタンをクリックすると、強化が適用され、パネルが自動的に非表示になる
16. 強化パネルが非表示になった後、「Win!」または「Lost!」表示を維持したままゲームモード選択パネルが表示される
17. ゲームモードを再選択すると、ゲームが再開される（Power・城のHPがリセット、フィールド上のキャラクター・エネミーが削除される）
18. ゲームモード選択前はエネミーのスポーンが開始されない（ゲームモード選択後に自動的にスポーンが開始される）
19. ステージシステム：画面右上に現在のステージ数を表示（「Stage: 1」など）。最初は「Stage: 1」。勝利した後、ゲームモードを選ぶとStageが１つ進む。Stageが１つ進むごとに、モンスターが表示される秒数が0.9倍になる（徐々に短くなって難易度が上がっていく）。負けた後、ゲームモードを選ぶとStage1からやり直しになる

### 英単語学習システム

- **問題形式**: 
  - 「English to Japanese」: 英単語を表示し、日本語訳の選択肢から選ぶ
  - 「Japanese to English」: 日本語を表示し、英単語の選択肢から選ぶ
- **データ管理**: CSVファイル（カンマ区切り）で英単語データを管理（追加・更新が容易）
- **選択肢**: ランダムに3つの選択肢を表示（正解1つを含む、重複なし）
- **タイマー**: 各問題に制限時間があり、カウントダウン表示
- **フィードバック**: 
  - 正解時: 「Get X Power!」を表示し、Powerが増加（「Good!」は表示しない）
  - 不正解時: 「Wrong!」を表示し、正解を表示
  - 時間切れ時: 「Time over!」を表示し、正解を一定時間（デフォルト5秒、インスペクターで変更可能）表示
- **リソース獲得**: 英単語問題に正解することでPowerを獲得（時間経過による自動増加はなし）
- **間違えた問題リスト**: ゲーム終了時に間違えた問題を回数順（多い順）で表示。各アイテムには英語/英熟語、日本語、間違えた回数が表示される。アイテム全体をクリックすると音声読み上げが実行される（macOSの`say`コマンドを使用）。ゲーム再開時にリストはリセットされる

## 操作方法

### PC（Steam）向け操作

- **キャラクター召喚**: マウスクリックで画面下部のキャラクターアイコンをクリック
- **一時停止**: `P`キーまたは`Space`キー
- **UI操作**: マウスクリック
- **英単語問題回答**: マウスクリックで選択肢をクリック

### 将来的な拡張（モバイル対応時）

- **キャラクター召喚**: タップ操作
- **一時停止**: 画面右上の一時停止ボタン
- **英単語問題回答**: タップ操作で選択肢を選択

## ターゲットプラットフォーム

### 初期リリース

- **Steam（PC）**
  - Windows 10/11
  - macOS 10.15以降
  - Linux（Ubuntu 20.04以降）

### 画面解像度

- **推奨解像度**: 1920x1080（Full HD）
- **最小解像度**: 1280x720（HD）
- **アスペクト比**: 16:9を基準とする（他のアスペクト比にも対応）

## ゲームの特徴

### コアメカニクス

1. **リソース管理**: 時間経過で自動増加するPowerを管理し、最適なタイミングでキャラクターを召喚
2. **戦略性**: キャラクターの種類と召喚タイミングを考えて戦略を立てる
3. **自動戦闘**: 召喚されたキャラクターは自動的に行動し、プレイヤーは戦略に集中できる

### ゲーム要素

- **英単語問題システム**: 画面中央に問題を表示し、選択肢から正解を選ぶ
- **ゲームモード選択**: ゲーム開始時に学習モードを選択（英→日 / 日→英）
- **プレイヤー城**: 左側に配置。敵が到達するとダメージを受ける。攻撃を受けた時に一瞬赤くフラッシュする視覚的フィードバック。HPが0になると「Lost!」が赤で表示され、ゲーム終了
- **敵城**: 右側に配置。プレイヤーキャラクターが攻撃対象。攻撃を受けた時に一瞬赤くフラッシュする視覚的フィードバック。HPが0になると「Win!」が緑で表示され、ゲーム終了
- **城のHPバー**: 背景バーとFillバーで構成。FillバーはHPに応じて減少する
- **道**: 両陣営の間にある進軍ルート
- **キャラクター**: 様々な種類のユニットを召喚可能。敵キャラクターだけでなく敵の城にも攻撃可能。攻撃時に突進アニメーションが発生
- **敵キャラクター**: 自動的に左方向へ進軍し、プレイヤーキャラクターと戦闘。プレイヤーの城にも攻撃可能。攻撃時に突進アニメーションが発生
- **ゲーム終了処理**: 城のHPが0になると、タイマー・スポーン・キャラクター・エネミーの動きが停止し、「Win!」または「Lost!」が表示される。その後、キャラクター強化UIが表示される
- **キャラクター強化システム**: ゲーム終了時にキャラクター強化UIが表示され、3つのボタン（Warrior、Archer、Mage）から1つだけ選択して強化できる。強化タイプはHP、攻撃力、攻撃速度、移動速度。各キャラクターごとに強化値をInspectorで設定可能（Warrior、Archer、Mageそれぞれで異なる強化量を設定できる）。強化ボタンのラベルには実際の設定値が表示される。強化ボタンをクリックすると、強化が適用され、パネルが自動的に非表示になり、ゲームモード選択パネルが表示される
- **ゲーム再開**: ゲームモードを再選択すると、Power・城のHPがリセットされ、フィールド上のキャラクター・エネミーが削除される。キャラクター強化は保持される（ゲーム再開時にリセットされない）
- **ステージシステム**: 画面右上に現在のステージ数を表示。勝利後、ゲームモードを選択するとStageが進む。敗北後、ゲームモードを選択するとStage1にリセット。Stageが進むごとに敵のスポーン間隔が0.9倍になり、難易度が上昇する
- **背景システム**: ステージごとに背景画像を切り替える。ステージが変更されると自動的に背景が切り替わる。Background GameObjectのSpriteRendererを使用して背景を表示

## 技術要件

### Unityバージョン

- **推奨バージョン**: Unity 2022.3 LTS以降

### 必須パッケージ

- Input System（新規プロジェクト推奨）
- TextMeshPro
- Unity UI（uGUI）

### パフォーマンス目標

- **フレームレート**: 60 FPS（最低30 FPS）
- **メモリ使用量**: 2GB以下
- **起動時間**: 5秒以内

---

## 最終更新日

2026年1月20日（CharacterUpgradeManager修正：各キャラクターごとに強化値をInspectorで設定可能に、CharacterUpgradeButton修正：ラベル表示を実際の設定値を使用するように変更）

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|----------|--------|
| 2026-01-15 | 初版作成 | - |
| 2026-01-16 | Phase 3.2完了、ResourceManagerシングルトン化完了を反映 | - |
| 2026-01-16 | Phase 4完了、敵システム実装完了、戦闘システムの移動再開機能修正完了 | - |
| 2026-01-16 | 英単語学習機能の追加仕様を反映（Powerの自動増加を無効化、英単語問題システム、ゲームモード選択） | - |
| 2026-01-17 | ライフゲージシステム実装完了（キャラクター・エネミーのHPバー表示、ダメージフラッシュエフェクト） | - |
| 2026-01-17 | リソース表示を「Money」から「Power」に変更、正解時のフィードバックメッセージに獲得Powerを表示 | - |
| 2026-01-17 | 城への攻撃機能実装完了（キャラクター・エネミーが城に攻撃可能）、城のダメージフラッシュエフェクト実装完了 | - |
| 2026-01-17 | 城のHPバーのFill表示問題修正、バックグラウンドバーの追加 | - |
| 2026-01-17 | フィードバックメッセージ変更（不正解時「Wrong!」、タイムオーバー時「Time over!」、正解時「Get X Power!」のみ） | - |
| 2026-01-17 | ゲーム終了処理実装（敵城HPが0→「Win!」、プレイヤー城HPが0→「Lost!」、ゲーム停止・再開機能） | - |
| 2026-01-17 | エネミーのスポーンタイミング修正（ゲームモード選択後に開始） | - |
| 2026-01-17 | 攻撃時の突進アニメーション実装（全キャラクター・エネミー） | - |
| 2026-01-17 | オーディオシステム実装完了（効果音：正解・不正解・スポーン・攻撃時、BGM：ゲームプレイ中・勝利時・敗北時） | - |
| 2026-01-17 | 忘却曲線ロジック実装：間違えた問題を2〜3回後に再出題する仕組みを追加 | - |
| 2026-01-17 | 正解時のリワードを10から30に変更 | - |
| 2026-01-17 | 勝利・敗北時の待機画面でQuestionTextとCorrectAnswerTextを表示したままにする修正 | - |
| 2026-01-18 | 間違えた問題リスト機能の音声読み上げ機能実装完了（アイテム全体をクリックするとMacOSTextToSpeechを使用して英語を読み上げる） | - |
| 2026-01-18 | IncorrectAnswerListItemUI修正：IPointerClickHandlerを実装してアイテム全体をクリック可能に変更 | - |
| 2026-01-18 | GameSceneManager作成：シーン管理システムを作成（タイトルシーンとゲームシーン間の遷移を管理）。ただし、最終的にタイトルシーンは使用しない方針に変更 | - |
| 2026-01-18 | GameEndHandler/GameModeSelectUI修正：タイトルシーンを使用しない構成に戻す（SampleSceneのみで完結） | - |
| 2026-01-19 | 開発ログ・仕様書更新：間違えた問題リスト機能の音声読み上げ機能実装、IPointerClickHandler実装、GameSceneManager作成、タイトルシーンを使用しない構成への変更を記録 | - |
| 2026-01-19 | ステージシステム実装完了：StageManager作成（ステージ数の管理、勝利時の増加、敗北時のリセット）、StageUI作成（画面右上に「Stage: X」を表示）、GameEndHandler修正（勝利/敗北フラグの管理）、GameModeSelectUI修正（ゲームモード選択時にステージ管理を実行）、EnemySpawner修正（Stageに応じてスポーン間隔を0.9倍に調整）、Unity Editorセットアップガイド作成 | - |
| 2026-01-20 | 背景システム実装完了：BackgroundManager修正（タイル表示機能を削除、Background GameObjectのSpriteRendererを使用したシンプルな背景切り替え機能に変更）、ステージ変更時に自動的に背景が切り替わる機能を実装、Unity Editorセットアップ完了 | - |
| 2026-01-20 | CharacterUpgradeUI修正：強化ボタンクリック後にパネルが自動的に非表示になり、ゲームモード選択パネルが表示される機能を追加（CharacterUpgradeUI.HidePanelAndShowModeSelection()メソッド追加、GameEndHandler.ShowGameModeSelection()メソッド追加） | - ||| 2026-01-20 | CharacterUpgradeManager修正：各キャラクターごとに強化値をInspectorで設定できるように修正（CharacterUpgradeSettingsクラス追加、characterUpgradeSettings配列追加、GetHealthUpgradeAmount/GetAttackPowerUpgradeAmount/GetAttackSpeedUpgradeAmount/GetMoveSpeedUpgradeAmountメソッドをパブリック化）。CharacterUpgradeButton修正：ラベル表示をハードコード値からCharacterUpgradeManagerの実際の設定値を使用するように変更（GetUpgradeDescription()メソッド修正） | - |
